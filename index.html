<html>
<head>
	<meta charset="utf-8" />
    <meta name="description" content="">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="cleartype" content="on">
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
		<link href="./css/bootstrap.css" rel="stylesheet">
		<link href="./css/bootstrap-responsive.css" rel="stylesheet">
		<link rel="stylesheet" href="./css/app.css">
		<script src="http://code.jquery.com/jquery-latest.js"></script>
		<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
		<script src="./js/bootstrap.js"></script>
		
<style type="text/css">
	html {height:100%}
	body {height:100%; margin:0; padding:0}
	#map_canvas {height:100%; width:100%}
</style>
</head>
<body>
<div data-role="page" id="running">
					<div data-role="header">
						<h1>Exercise Healthy</h1>
					</div>
					
						<script type="text/javascript" charset="utf-8" src="cordova-2.5.0.js"></script>
						<table border="1" cellspacing="0" cellpadding="0" align="CENTER"  >
					
							<tr>
								<td colspan="2" width="330" height="350">
								<br>
								<div id="map_canvas" align="center"></div>
								</td>
							</tr>						
							<tr id="tr">
								<td width="25px" height="5px" align="CENTER">
									Distance<h1 id="distance" style="font-size:20px;">0 m</h1>
									
								</td>
								<td width="25px" height="5px" align="CENTER">
									Time<h1 id="timer" style="font-size:20px;">00:00:00</h1>
								</td>
							</tr>	
						</table>
						<br><br>						
						<center>
							<button type="button" id="btn-start-pause" class="btn btn-large btn-success" style="width:50%;height:50px;">Start</button>
							<button type="button" id="btn-stop" class="btn btn-large btn-danger" style="width:50%;height:50px;">Stop</button>
						</center>

					<script type="text/javascript">  
						var timeuse = 0;
						var timealluse = 0;
						var timeinterval = 0;
						var timeall = 0;
						var end = 0;
						var distance_log = 0;
						var lap_array = new Array();
						var dis_array = new Array();
						var path = [];
						//var src = "";
						//var visibleMap = map1;
						//var hiddenMap = map2;
						var Globals = {
							totalDistance: 0,
							latestDistance: 0,
							latestTime: 0,
							cntUpdates: 0,
							startTime: Date.now(),
							latestDistanceTime: 0
						};
						var distanceElement = document.getElementById('distance');
						var latestPosition;
						var lastDistanceTimeTemp = 0;
						var R = 6371; // km
						var toRad = Math.PI / 180;
						
						function millisectotime(mill)
						{
							var hour = Math.floor(timeinterval/36000);
							var min = Math.floor(timeinterval/600)%60;
							var sec = Math.floor(timeinterval/10)%60;

							if (hour < 10) hour = "0" + hour;
							if (min < 10) min = "0" + min;
							if (sec < 10) sec = "0" + sec;
							return (hour + ":" + min + ":" + sec  );


						}

						function TimerOK()
						{	
							timeinterval = timeinterval + 1;
							$('#timer').html(millisectotime(timeinterval));
							localStorage.setItem('timer_current',timeinterval);
							localStorage.setItem('timer_history',JSON.stringify(lap_array));
							

							if(timeuse == 1)
							{
								setTimeout('TimerOK()', 100);
							}
						}

						function millisectime(mills)
						{
							var hour = Math.floor(timeall/36000);
							var min = Math.floor(timeall/600)%60;
							var sec = Math.floor(timeall/10)%60;

							if (hour < 10) hour = "0" + hour;
							if (min < 10) min = "0" + min;
							if (sec < 10) sec = "0" + sec;

							return (hour + ":" + min + ":" + sec);
						}

						function ResetTime()
						{	
							timeuse = 0;
							timeinterval = 0;
							$('#timer').html(millisectotime(timeinterval));
						}

						function Timeall()
						{
							timeall = timeall + timeinterval;
							$('#timeall').html(millisectime(timeall));
							localStorage.setItem('time_all',timeall);
							if(timealluse == 0)
							{
								setTimeout('Timeall()', 100);
							}
						}
		
		function Mapdis(){
        var options = { timeout: Infinity };
        var watchID = navigator.geolocation.watchPosition(initialize, onError, options);

var map; // ย“หนิตาแผ map ๅฉีฉานฺังยฌห‘ู เฟ—้ฃฬฉห’ย’รถแ•ยกใซฉศ’ู ษ’ย้นฮ—่บคีฉ  
var GGM; // ย“หนิตาแผ GGM ๅฉเขงฺ google.maps Object ษไตฉแ•ยกใซฉศ’ฺคีฉศจำร–้น  
var arr_path=[]; // ย“หนิตาแผห“ฬับเขงฺค้“ำ ฤ์ ติกหน่ง path  
var makePolyline; // ย“หนิตาแผ เ ‘วก์ซ‘่น ห๊’งแฉู polylines  
var objPolylines=[]; // ย“หนิตาแผห“ฬับเขงฺค้’ object รว polylines  

////////////////////////////////////
						
						
//////////////////////////////////
function initialize(position) { 
    GGM=new Object(google.maps);
    var my_Latlng  = new GGM.LatLng(position.coords.latitude,position.coords.longitude);  
    var my_mapTypeId=GGM.MapTypeId.ROADMAP; 
    var my_DivObj=$("#map_canvas")[0];   
    var myOptions = {  
        zoom: 16, 
        center: my_Latlng , 
        mapTypeId:my_mapTypeId 
    };  
    map = new GGM.Map(my_DivObj,myOptions);
      
     var my_Marker = new GGM.Marker({ 
        position: my_Latlng,  
        map: map,  
        draggable:false, 
    });  
    
      
    GGM.event.addListener(map, "bounds_changed", function() {  
        var my_Point = my_Marker.getPosition(my_Latlng);  
        arr_path.push(my_Point);
        map.panTo(my_Point);
        if(end == 0){     
        makePolyline(arr_path);
		}
    });
	
								if (latestPosition &&
									position.coords.latitude === latestPosition.coords.latitude &&
									position.coords.longitude === latestPosition.coords.longitude) {
									return;
								}

								latestPosition = position;
								path.push(latestPosition.coords);
								
								if(end == 0){
									Globals.cntUpdates++;
								}
								// calculate total distance
								if (Globals.cntUpdates > 1) {
									Globals.latestDistance = distance(path[Globals.cntUpdates - 1], path[Globals.cntUpdates - 2]);
									Globals.totalDistance += Globals.latestDistance;
								}
								

							var totalDistanceString;
								if (this.totalDistance > 1) {
									totalDistanceString = Math.round(Globals.totalDistance * 1000) / 1000 + " km";
									distance_log = Math.round((Globals.totalDistance * 1000) / 1000);
								}
								else {
									totalDistanceString = Math.round(Globals.totalDistance * 1000) + " m";
									distance_log = Math.round(Globals.totalDistance * 1000);
								}

								distanceElement.innerHTML = " " + totalDistanceString;				
								} 
								function distance(pos1, pos2) {
								var lat1 = pos1.latitude;
								var lon1 = pos1.longitude;
								var lat2 = pos2.latitude;
								var lon2 = pos2.longitude;

								var dLat = (lat2 - lat1) * toRad;
								var dLon = (lon2 - lon1) * toRad;
								lat1 = lat1 * toRad;
								lat2 = lat2 * toRad;

								var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
									Math.sin(dLon / 2) * Math.sin(dLon / 2) * Math.cos(lat1) * Math.cos(lat2);
								var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
								var d = R * c;

								return d;
							}
							localStorage.setItem('distance_current',distance_log);
							localStorage.setItem('distance_history',JSON.stringify(dis_array));
							
							makePolyline=function(arr_path){  
							var i=arr_path.length-1;  
							objPolylines[i] = new GGM.Polyline({ 
								path: arr_path,
								strokeColor: "#FF0000",
								strokeOpacity: 1.0, 
								strokeWeight: 2
							});   
							objPolylines[i].setMap(map);    
							}  
							
							clearMapPolylines=function(){  
								arr_path=[];      
							for(i=0;i<objPolylines.length;i++){
								objPolylines[i].setMap(null);  
							}  
							}
}

function onError(error) {
        alert('code: '    + error.code    + '\n' +
              'message: ' + error.message + '\n');
    }
	

				$(document).ready(function() { // On page load completed do it function.
							var status = 0;
							var btntoggle = 0;
							var btntoggles  =0;
							
							if(localStorage.getItem('timer_history') && localStorage.getItem('timer_current')){
								lap_array = JSON.parse(localStorage.getItem('timer_history'));
								timeinterval = parseInt(localStorage.getItem('timer_current'));
							}
							
							if(localStorage.getItem('distance_history') && localStorage.getItem('distance_current')){
								dis_array = JSON.parse(localStorage.getItem('distance_history'));
								distance_log = parseInt(localStorage.getItem('distance_current'));
							}
							
							if(localStorage.getItem('time_all'))
							{
									timeall = parseInt(localStorage.getItem('time_all'));
							}		
							var buildstring = "";

								for(var i = 0; i < lap_array.length;i++)
								{
									buildstring =  '<h1 style="font-size:40px">' + (i+1) + ' - ' + lap_array[i] + ' - ' + dis_array[i] + '</h1>' + buildstring ;			
								}
								
							$('#timeall').html(millisectime(timeall));
							$('#distance').html(distance_log);
							$('#mytime2').html(buildstring);
							$('#timer').html(millisectotime(timeinterval));
							
	
							$('#btn-delall').on('click',function(){
								localStorage.removeItem('timer_current');
								localStorage.removeItem('timer_history');
								timeinterval = 0;
								$('#timer').html(millisectotime(timeinterval));
								$('#mytime').html("");
								$('#mytime2').html("");
									lap_array.length = 0;
									dis_array.length = 0;
							});
	

							$('#btn-start-pause').on('click',function(){
								if (btntoggle == 0)
								{
									$('#btn-start-pause').removeClass("btn-success");
									$('#btn-start-pause').addClass("btn-inverse");
									$('#btn-start-pause').html('Pause');
								
									timeuse = 1;								
									TimerOK();
									Mapdis();
									btntoggle = 1;
									end = 0;
									
								
								}
								else
								{
									$('#btn-pause').removeClass("btn-inverse");
									$('#btn-pause').addClass("btn-success");
									$('#btn-pause').html('Start');
									timeuse = 0;
									btntoggles =1;
								}
							});	
									
							$('#btn-stop').on('click',function(){	

									$('#btn-start-pause').removeClass("btn-inverse");
									$('#btn-start-pause').addClass("btn-success");
									$('#btn-start-pause').html('Start');
									$('#distance').html('0 m');
									
									btntoggle = 0;
									Timeall();
									timealluse = 1;
									end =1;
									dis_array.push(distance_log);
									lap_array.push(millisectotime(timeinterval));
									//dis_array.push(distance_log);
									
									
									var buildstring = "";
										for(var i = 0; i < lap_array.length;i++)
										{
										buildstring =  '<h1 style="font-size:40px">' + (i+1) + ' - ' + lap_array[i] + ' - ' + dis_array[i] + '</h1>' + buildstring ;
										}
											
									
									$('#mytime2').html(buildstring);
									ResetTime();
									
									//////////////////////
									path = [];
									Globals.cntUpdates = 0;
									Globals.totalDistance = 0;
									initialize(latestPosition);
									clearMapPolylines();
								
									///////////////////////
									
								
							});
					});
  
$(function(){  
    $("<script/>", {  
      "type": "text/javascript",  
      src: "http://maps.google.com/maps/api/js?v=3.2&sensor=false&language=th&callback=initialize"  
    }).appendTo("body");      
});

					</script>   
					
					<div data-role="footer" data-position="fixed" class="nav-glyphish-example">
						
						<div data-role="navbar" class="nav-glyphish-example" data-grid="c">
							<ul>
								<li><a href="#running" id="brunning" >Running</a></li>
								<li><a href="#route" id="broute">Route</a></li>
								<li><a href="#friend" id="bfriend" >Friend</a></li>
								<li><a href="#history" id="bhistory" >History</a></li>
							</ul>
						</div>
					</div>		
		</div>					

		<div data-role="page" id="route">
					<div data-role="header">
						<h1>Exercise Healthy</h1>
					</div>
		2

					<div data-role="footer" data-position="fixed" class="nav-glyphish-example">
						<div data-role="navbar" class="nav-glyphish-example" data-grid="c">
							<ul>
								<li><a href="#running" id="brunning" >Running</a></li>
								<li><a href="#route" id="broute">Route</a></li>
								<li><a href="#friend" id="bfriend" >Friend</a></li>
								<li><a href="#history" id="bhistory" >History</a></li>
							</ul>
						</div>
					</div>	
		</div>

		<div data-role="page" id="friend">
					<div data-role="header">
						<h1>Exercise Healthy</h1>
					</div>
		3

					<div data-role="footer" data-position="fixed" class="nav-glyphish-example">
						<div data-role="navbar" class="nav-glyphish-example" data-grid="c">
							<ul>
								<li><a href="#running" id="brunning" >Running</a></li>
								<li><a href="#route" id="broute">Route</a></li>
								<li><a href="#friend" id="bfriend" >Friend</a></li>
								<li><a href="#history" id="bhistory" >History</a></li>
							</ul>
						</div>
					</div>	
		</div>

		<div data-role="page" id="history">
					<div data-role="header">
						<h1>History</h1>
					</div>
					<style>
						.block {
								display: block;
								margin: 0 0 10px;
								font-size: 13px;
								word-break: break-all;
								word-wrap: break-word;
								background-color: #cccccc;
								border: 1px solid #ccc;
								border: 1px solid rgba(0, 0, 0, 0.15);
								-webkit-border-radius: 4px;
								-moz-border-radius: 4px;
								border-radius: 4px;
								}
					</style>
					
					<div id="mytimeblock1" class="block" style="overflow-x: hidden;overflow-y: scroll;height:60%;margin: 0px 5px 5px 5px;">
						<center id="mytime2">
						
						</center>
					</div>
						<!--<button type="button" id="btn-delall" class="btn-danger" style="width:100%;height:60px;margin:140% 0% 0% 0%">DELETE ALL DATA</button>-->
	
					<div data-role="footer" data-position="fixed" class="nav-glyphish-example">
						<div data-role="navbar" class="nav-glyphish-example" data-grid="c">
							<ul>
								<li><a href="#running" id="brunning" >Running</a></li>
								<li><a href="#total time" id="bTotal">Total Time</a></li>
								<li><a href="#total distanc" id="bdistanc" >Total Distanc</a></li>
								<li><a href="#total best" id="bbest" >Total Best</a></li>
							</ul>
						</div>
					</div>
		</div>
		
		<div data-role="page" id="total time">
					<div data-role="header">
						<h1>Exercise Healthy</h1>
					</div>
					<style>
						.block {
								display: block;
								margin: 0 0 10px;
								font-size: 13px;
								word-break: break-all;
								word-wrap: break-word;
								background-color: #cccccc;
								border: 1px solid #ccc;
								border: 1px solid rgba(0, 0, 0, 0.15);
								-webkit-border-radius: 4px;
								-moz-border-radius: 4px;
								border-radius: 4px;
								}
					</style>
					
					<div id="mytimeblock2" class="block" style="height:100%">
					<br><br><br>
						<h1><center>Total Time</center></h1>
						<h1><center id="timeall"></h1>
						
						</center>
						<button type="button" id="btn-reset" class="btn-danger" style="width:50%;height:60px;margin:140% 0% 0% 0%">Reset</button>
					<div data-role="footer" data-position="fixed" class="nav-glyphish-example">
						<div data-role="navbar" class="nav-glyphish-example" data-grid="c">
							<ul>
								<li><a href="#running" id="brunning" >Running</a></li>
								<li><a href="#total time" id="bTotal">Total Time</a></li>
								<li><a href="#total distanc" id="bdistanc" >Total Distanc</a></li>
								<li><a href="#total best" id="bbest" >Total Best</a></li>
							</ul>
						</div>
					</div>	
					</div>
		</div>			
		
		<div data-role="page" id="total distanc">
					<div data-role="header">
						<h1>Exercise Healthy</h1>
					</div>
					<style>
						.block {
								display: block;
								margin: 0 0 10px;
								font-size: 13px;
								word-break: break-all;
								word-wrap: break-word;
								background-color: #cccccc;
								border: 1px solid #ccc;
								border: 1px solid rgba(0, 0, 0, 0.15);
								-webkit-border-radius: 4px;
								-moz-border-radius: 4px;
								border-radius: 4px;
								}
					</style>
					
					<div id="mytimeblock3" class="block" style="overflow-x: hidden;overflow-y: scroll;height:60%;margin: 0px 5px 5px 5px;">
						<center>Total distanc</center>
						
						<center id="distance">
						
						</center>
						
					<div data-role="footer" data-position="fixed" class="nav-glyphish-example">
						<div data-role="navbar" class="nav-glyphish-example" data-grid="c">
							<ul>
								<li><a href="#running" id="brunning" >Running</a></li>
								<li><a href="#total time" id="bTotal">Total Time</a></li>
								<li><a href="#total distanc" id="bdistanc" >Total Distanc</a></li>
								<li><a href="#total best" id="bbest" >Total Best</a></li>
							</ul>
						</div>
					</div>				
					</div>
					
		</div>			
		
		<div data-role="page" id="total best">
					<div data-role="header">
						<h1>Exercise Healthy</h1>
					</div>
					<style>
						.block {
								display: block;
								margin: 0 0 10px;
								font-size: 13px;
								word-break: break-all;
								word-wrap: break-word;
								background-color: #cccccc;
								border: 1px solid #ccc;
								border: 1px solid rgba(0, 0, 0, 0.15);
								-webkit-border-radius: 4px;
								-moz-border-radius: 4px;
								border-radius: 4px;
								}
					</style>
					
					<div id="mytimeblock4" class="block" style="overflow-x: hidden;overflow-y: scroll;height:60%;margin: 0px 5px 5px 5px;">
						<h1><center>Total Best</center></h1>
						<h1><center id="totalbest"></h1>
						
						</center>

					<div data-role="footer" data-position="fixed" class="nav-glyphish-example">
						<div data-role="navbar" class="nav-glyphish-example" data-grid="c">
							<ul>
								<li><a href="#running" id="brunning" >Running</a></li>
								<li><a href="#total time" id="bTotal">Total Time</a></li>
								<li><a href="#total distanc" id="bdistanc" >Total Distanc</a></li>
								<li><a href="#total best" id="bbest" >Total Best</a></li>
							</ul>
						</div>
					</div>	
					</div>
		</div>
		
	</body>
</html> 
