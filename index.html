<!DOCTYPE HTML> 
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-type" content="text/html; charset=utf-8">

<title>RunforHealth</title>

    <script type="text/javascript" charset="utf-8" src="cordova-2.5.0.js"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
    
    
	
	<link href="bootstrap.css" rel="stylesheet">
	<script src="bootstrap.js"></script>

	
<!-- CSS Style Sheet
<link rel="stylesheet" href="css/jquery.mobile-1.3.1.min.css">
<link rel="stylesheet" href="css/jquery.mobile.structure-1.3.1.css">

<!-- JQM
<script src="js/jquery-1.9.0.js"></script>
<script src="js/jquery.mobile-1.3.1.min.js"></script>-->



    <style type="text/css">
	html {height:100%}
	body {height:100%; margin:0; padding:0}
	#map_canvas {height:100%; width:100%}
	</style>
    
    <script type="text/javascript" charset="utf-8">
    
    // ----------------------Time Set--------------------------------------------------
      var ms = 0;
		var state = 0;

		function startstop() {
			if (state == 0) {
			state = 1;
			then = new Date();
			then.setTime(then.getTime() - ms);
			}   
			else {
			state = 0;
			now = new Date();
			ms = now.getTime() - then.getTime();

			hours = Math.floor(ms%(1000 * 60 * 60 * 24)/(1000 * 60 * 60));
			if (hours < 10)
			hours = "0" + hours

			minutes = Math.floor((ms%(1000 * 60 * 60))/(1000 * 60));
			if (minutes < 10)
			minutes = "0" + minutes

			seconds = Math.floor((ms%(1000 * 60))/1000);
			if (seconds < 10)
			seconds = "0" + seconds
    	
			document.all('timer').innerHTML = '<h1>'+hours+':'+minutes+':'+seconds+'</h1>';
   	   		}
		}

		function swreset() {
			state = 0;
			ms = 0;
			document.all('timer').innerHTML = '<h1>00:00:00</h1>';  
			
		}

		function display() {
		setTimeout("display();", 500);
		if (state == 1)  {
		now = new Date();
		ms = now.getTime() - then.getTime();
		hours = Math.floor(ms%(1000 * 60 * 60 * 24)/(1000 * 60 * 60));
		if (hours < 10)
		hours = "0" + hours

		minutes_divisor = ms%(1000 * 60 * 60);
		minutes = Math.floor(minutes_divisor/(1000 * 60));
		if (minutes < 10)
		minutes = "0" + minutes

		seconds_divisor = ms%(1000 * 60);
		seconds = Math.floor(seconds_divisor/1000);
		if (seconds < 10)
		seconds = "0" + seconds

		document.all('timer').innerHTML = '<h1>'+hours+':'+minutes+':'+seconds+'</h1>';
   		}
		}
        </script>

</head>  
  
<body>  
   <div data-role="page" id="page">

    <!--<div class="btn-group btn-group-justified" align="CENTER">
		<h1>RunforHealth</h1>
	</div>-->
	
	<div class="navbar navbar-inverse navbar-static-top">
		<div class="navbar-inner">
			  <a class="brand" href="#" style="float:center"><center><h1>RunforHealth</h1></center></a>
		</div>
	</div><br>
	
	<table border="0" cellspacing="0" cellpadding="0" align="CENTER">
	<tr>
	<td colspan="2" width="351" height="251">
	<div id="map_canvas" align="center"></div>
	</td>
	</tr>

    </table>
    <table border="0" cellspacing="0" cellpadding="0" align="CENTER">
    <form NAME="stpw">
 <tr>
	<td>
    <h4>Time&nbsp;:&nbsp;</h4>
    </td>
    <td>
	<div id="timer" class="logininput" align="center"><h1>00:00:00</h1></div>
    </td>
</tr>
<tr>
	<td colspan="2">
	<div onClick="display()" align="center">
	<button type="button" class="btn btn-small btn-success btn-block" style="width:100%;height:60px;" Name="ssbutton" onClick="startstop()">Start/Stop</button>

	<div onClick="clearMapPolylines()" >
	<button type="button" class="btn btn-large btn-primary btn-block" style="width:100%;height:60px;" NAME="reset" onClick="swreset()">End</button>
	</div>
	</div>
	</form>
    	</td>
</tr>
</table>
</div>
 
    
<script src="http://code.jquery.com/jquery-latest.js"></script>
<script type="text/javascript">  

        var options = { timeout: 30000 };
        var watchID = navigator.geolocation.watchPosition(initialize, onError, options);

var map; // ˹Ե҇ἃ map 利թҹڍѧ¬ˑ٠࿗鎣̩˒öᄕ¡㫩Ȓ٠ɒ釹Η躤թ  
var GGM; // ˹Ե҇ἃ GGM 利ࢧڠgoogle.maps Object ɐ䵩ᄕ¡㫩ȒڤթȨӂÖ鹠 
var arr_path=[]; // ˹Ե҇ἃ˓̃Ѻࢧڤ铍ӠĂ젵ԡ˹觠path  
var makePolyline; // ˹Ե҇ἃ ࠑǡ쫑蹠˃꒧ዩ٠polylines  
var objPolylines=[]; // ˹Ե҇ἃ˓̃Ѻࢧڤ钠object ÍǠpolylines  
function initialize(position) { // ࠑǡ쫑ڡʴȡܹؕ蠠
    GGM=new Object(google.maps); // ࢧڵ҇ἃ google.maps Object 利㹵҇ἃ GGM  
    // ˹Ԩشᄔ遵鹢ͧἹؕ蠠
    var my_Latlng  = new GGM.LatLng(position.coords.latitude,position.coords.longitude);  
    var my_mapTypeId=GGM.MapTypeId.ROADMAP; // ˹ՃٻẺἹؕ踕颊ԧ  
    // ˹ԠDOM object ؕ詐᎒Ἱؕ餻⊴Ǡؕ躕饗͠div id=map_canvas  
    var my_DivObj=$("#map_canvas")[0];   
    // ˹ԠOption Íȡܹؕ蠠
    var myOptions = {  
        zoom: 16, // ˹ԢڒԡӃ zoom  
        center: my_Latlng , // ˹Ԩش觡ƒǠ 
        mapTypeId:my_mapTypeId // ˹ՃٻẺἹؕ蠠
    };  
    map = new GGM.Map(my_DivObj,myOptions);// ˃꒧Ἱؕ颅Ѡ§ڵ҇ἃ利㹪ب͠map  
      
     var my_Marker = new GGM.Marker({ // ˃꒧֑Ǡmarker  
        position: my_Latlng,  // ˹դȩؕ頴ւǡѺɘԡרǡƒǠ 
        map: map, // ˹Շ钠marker ڕ꣪频ܹۡؕ諗鍠instance ȨҠmap  
        draggable:false, // ˹գ̩˒öƒu҇ marker ڕꤴ頠
        title:"Ņԡƒ ߗ鎋ҵԡ˹觨شؕ趩ͧá" // ⊴Ǡtitle ႗鎠Β႒ˬ΂ڨዹ؍  
    });  
    
      
    // ˹Ԡevent 䌩ڵ҇ marker ႗鎊թڊشąҡ֑Ǡmarker 䌩ؓȒڍѤà 
    GGM.event.addListener(map, "bounds_changed", function() {  
        var my_Point = my_Marker.getPosition(my_Latlng);  // ̒֓⋹觢֑ͧǠmarker ႗鍡Յҡ↩ǻƨ΂  
        arr_path.push(my_Point); // ࿔遤钵ԡ˹觠ɒu҇ marker ֓⋹訅铊ش  
        map.panTo(my_Point);  // 䌩Ἱؕ颊ԧ价֑֨Ǡmarker ƨӊش  
                  
        makePolyline(arr_path); // ˨Ǥ钵ԡ˹訣٠array 伊ĩҧዩ٠polylines 㺡ܹؕ蠠
//      console.log(arr_path);  
    });      
  
    // ˹Ԡevent 䌩ڵ҇Ἱؕ衠鎁աӃ༅֨¹ἅǡӃ zoom  
    /*GGM.event.addListener(map, "zoom_changed", function() {  
        $("#zoom_value").val(map.getZoom()); // ᎒¹Ҵ zoom Íȡܹؕ颊ԧ㹠textbox id=zoom_value    
    });  */
}  

function onError(error) {
        alert('code: '    + error.code    + '\n' +
              'message: ' + error.message + '\n');
    }
  
makePolyline=function(arr_path){  
//  console.log(arr_path.length);  
    var i=arr_path.length-1;  
    objPolylines[i] = new GGM.Polyline({ // ˹ՃٻẺÍȠ˩٠polylines  
        path: arr_path,// array ֓⋹觷֨ࢧڤ钠lat,lon  
        strokeColor: "#FF0000", // ˕  
        strokeOpacity: 1.0, // ŇӁ⼃訣ʠ 
        strokeWeight: 2 //ŇӁ˹꒢ͧዩ٠ 
    });   
    objPolylines[i].setMap(map);    // ˃꒧ዩ٠polylines 㺡ܹؕ蠠
//  console.log(arr_path);  
//  console.log(objPolylines);  
}  
clearMapPolylines=function(){  
    arr_path=[];      
    for(i=0;i<objPolylines.length;i++){  
//      console.log(i);  
        objPolylines[i].setMap(null);  
    }  
  
//  console.log(arr_path);  
}  
$(function(){  
    $("<script/>", {  
      "type": "text/javascript",  
      src: "http://maps.google.com/maps/api/js?v=3.2&sensor=false&language=th&callback=initialize"  
    }).appendTo("body");      
});  
</script>    
</body>  
</html>  
